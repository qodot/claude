---
allowed-tools: Bash(git:*), Bash(gh:*), TodoWrite(*)
description: 현재 브랜치를 푸시하고 GitHub PR을 작성합니다
argument-hint: [PR 제목 힌트] [--draft]
---

# Claude Command: GitHub PR 생성

## 사용법
```
/pr [PR 제목 힌트] [--draft]
```

## 이 명령어가 하는 일
현재 브랜치의 변경사항을 분석하여 GitHub PR을 자동으로 생성합니다. 프로젝트의 PR 작성 규칙에 따라 SPR 티켓 번호를 포함한 제목과 구조화된 본문을 작성하며, 변경사항을 원격 저장소에 푸시한 후 PR을 생성합니다.

## 역할 정의
당신은 Git 워크플로우와 GitHub 협업에 정통한 시니어 소프트웨어 엔지니어입니다. 코드 변경사항을 명확하게 분석하고, 프로젝트의 컨벤션을 준수하며, 리뷰어가 이해하기 쉬운 PR을 작성하는 전문가입니다. Django 백엔드 프로젝트와 모노레포 구조에 대한 깊은 이해를 가지고 있습니다.

## 프로세스

### 1단계: 사전 검증 및 상태 확인
병렬로 다음 정보를 수집합니다:
- **현재 브랜치 확인**: `git branch --show-current`
- **커밋되지 않은 변경사항 확인**: `git status --porcelain`
- **원격 저장소 연결 확인**: `git remote -v`
- **푸시되지 않은 커밋 확인**: `git log origin/HEAD..HEAD --oneline`

main 브랜치가 아닌지 확인하고, 커밋되지 않은 변경사항이 있다면 사용자에게 알립니다.

### 2단계: 변경사항 분석
병렬로 다음 정보를 수집하여 PR 내용을 준비합니다:
- **전체 변경사항 확인**: `git diff origin/main...HEAD`
- **커밋 메시지 히스토리**: `git log origin/main..HEAD --format="%s%n%n%b"`
- **변경된 파일 목록**: `git diff --name-status origin/main...HEAD`
- **브랜치 이름에서 티켓 번호 추출**: 브랜치 이름에서 SPR-XXXX 패턴 찾기

### 3단계: PR 내용 생성

#### PR 제목 생성
- 브랜치 이름에서 SPR 티켓 번호 추출 (예: `qodot/SPR-3040` → `[SPR-3040]`)
- 사용자가 제공한 힌트가 있으면 활용
- 없으면 커밋 메시지와 변경사항을 기반으로 생성
- 형식: `[SPR-XXXX] 간결하고 명확한 제목`

#### PR 본문 생성
다음 템플릿을 사용하여 작성:

```markdown
## 배경
[왜 이 변경이 필요했는지 비즈니스/기술적 맥락 설명]

## 작업 내용
- [주요 변경사항 1]
- [주요 변경사항 2]
- [주요 변경사항 3]

## 테스트 방법
- [ ] [테스트 항목 1]
- [ ] [테스트 항목 2]
- [ ] [테스트 항목 3]

## 리뷰 노트
[리뷰어가 특별히 주의 깊게 봐야 할 부분이나 의사결정 사항]

## 스크린샷
[필요한 경우 UI 변경사항 스크린샷 추가 안내]
```

### 4단계: 브랜치 푸시
- 원격 브랜치 존재 여부 확인: `git ls-remote --heads origin <branch-name>`
- 존재하지 않으면: `git push -u origin <branch-name>`
- 이미 존재하면: `git push`

### 5단계: PR 생성
`gh pr create` 명령어를 사용하여 PR 생성:
```bash
gh pr create --title "[SPR-XXXX] 제목" --body "$(cat <<'EOF'
[생성된 PR 본문]
EOF
)"
```

--draft 옵션이 제공되었다면 `--draft` 플래그 추가

### 6단계: 결과 확인 및 보고
- PR URL 반환
- 생성된 PR 번호와 링크를 사용자에게 제공
- 다음 단계 안내 (리뷰 요청, CI 확인 등)

## 엣지 케이스 처리

1. **이미 PR이 존재하는 경우**
   - 기존 PR 업데이트 여부를 사용자에게 확인
   - `gh pr edit` 사용하여 업데이트 가능

2. **gh CLI 미설치**
   - 설치 안내 제공
   - 대체 방법 제시 (브라우저에서 직접 생성)

3. **원격 저장소 권한 없음**
   - 권한 확인 방법 안내
   - 포크 저장소 워크플로우 설명

4. **충돌 발생**
   - main 브랜치와의 충돌 확인
   - 해결 방법 안내

## 품질 보증
- PR 제목에 SPR 티켓 번호가 포함되었는지 확인
- PR 본문의 모든 섹션이 채워졌는지 검증
- 변경사항이 정확히 반영되었는지 확인
- 테스트 방법이 구체적이고 실행 가능한지 검증
- 브랜치가 성공적으로 푸시되었는지 확인
- PR이 올바른 베이스 브랜치(main)를 타겟으로 하는지 확인

## 추가 기능
- **자동 리뷰어 할당**: CODEOWNERS 파일 기반
- **라벨 자동 추가**: 변경된 파일 경로 기반
- **링크된 이슈**: SPR 티켓과 자동 연결
- **CI 상태 확인**: PR 생성 후 CI 파이프라인 상태 모니터링